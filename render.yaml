# render.yaml
services:
  - type: web
    name: nexusk-forum
    env: docker
    plan: free
    dockerfilePath: ./Dockerfile
    # 关键修改：使用 TCP 健康检查代替 HTTP 检查
    healthCheck:
      # 告诉 Render 只检查端口是否可监听即可
      tcp: true
      # 首次检查前的等待时间，给容器启动脚本留出时间
      initialDelaySeconds: 60
      # 检查的间隔时间
      periodSeconds: 30
    envVars:
      - key: FORUM_URL
        value: https://nexusk-forum.onrender.com
      - key: DB_HOST
        fromDatabase:
          name: nexusk-database
          property: host
      - key: DB_NAME
        fromDatabase:
          name: nexusk-database
          property: database
      - key: DB_USER
        fromDatabase:
          name: nexusk-database
          property: user
      - key: DB_PASS
        fromDatabase:
          name: nexusk-database
          property: password
      - key: FLARUM_ADMIN_USER
        value: admin
      - key: FLARUM_ADMIN_PASS
        value: nexusk2025
      - key: FLARUM_ADMIN_MAIL
        value: admin@nexusk.com
      - key: FLARUM_TITLE
        value: NexusK 服务器论坛
      - key: TZ
        value: Asia/Shanghai

databases:
  - name: nexusk-database
    databaseName: nexusk
    plan: free